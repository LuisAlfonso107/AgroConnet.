<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Mercado Global Agrícola en AgroConnect: Precios reales al 11 Nov 2025, tendencias, análisis y guías para productores y compradores." />
  <meta name="theme-color" content="#00796b" />

  <!-- CSS -->
   <link rel="stylesheet" href="../styles.css"> 
  <link rel="stylesheet" href="style.css">
 

  <title>Mercado Global | AgroConnect</title>

  <!-- FUENTES -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
</head>
<body>

  <!-- HEADER DINÁMICO -->
  <div id="header-container"></div>
  <script>
    fetch("/components/header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-container").innerHTML = html;

        // Cargar script del header
        const script = document.createElement("script");
        script.src = "/components/header.js";
        document.body.appendChild(script);

        // NAV SCROLL & HAMBURGER
        const navbar = document.getElementById('navbar');
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('navMenu');

        if (navbar) {
          window.addEventListener('scroll', () => {
            navbar.classList.toggle('scrolled', window.scrollY > 50);
          });
        }

        if (hamburger && navMenu) {
          hamburger.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            hamburger.innerHTML = navMenu.classList.contains('active') 
              ? '<i class="fas fa-times"></i>' 
              : '<i class="fas fa-bars"></i>';
          });
        }

        // ANIMACIONES
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.3 });
        document.querySelectorAll('.fade-up, .scale-in').forEach(el => observer.observe(el));
      })
      .catch(() => console.warn("Header no cargado"));
  </script>

  <!-- HERO -->
  <section class="hero-mercado fade-up">
    <div class="hero-bg-mercado"></div>
    <div class="container">
      <h1 class="fade-up">Mercado Global Agrícola</h1>
      <p class="fade-up">Guía masiva con <strong>precios en tiempo real</strong>, tendencias y análisis. Actualización automática cada 30 min.</p>
      <div class="cta-mercado fade-up">
        <a href="#precios" class="btn-mercado"><i class="fas fa-sync-alt"></i> Precios en Vivo</a>
        <a href="#analisis" class="btn-mercado"><i class="fas fa-file-alt"></i> Análisis Completo</a>
      </div>
    </div>
  </section>

  <!-- ÍNDICE GLOBAL -->
  <section class="container indice-global fade-up">
    <h3>Índice de Precios Alimentarios FAO</h3>
    <div class="indice-value" id="fao-index">126.4</div>
    <div class="indice-change negative" id="fao-change">-1.6% (mensual)</div>
    <p style="text-align:center; margin-top:1rem; color:var(--text-light);">
      Última actualización: <span id="fao-date">Octubre 2025</span> | Fuente: <a href="https://www.fao.org/worldfoodsituation/foodpricesindex/en" class="fuente-link">FAO</a>
    </p>
  </section>

  <!-- TABLA DE PRECIOS -->
  <section class="container" id="precios">
    <h2 class="fade-up">Precios Actuales <small style="color:var(--text-light);font-weight:400;">(se actualizan automáticamente)</small></h2>
    <div class="tabla-precios fade-up">
      <table id="prices-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Precio Actual</th>
            <th>Cambio Mensual</th>
            <th>Cambio Anual</th>
            <th>Tendencia 2025</th>
            <th>Fuente</th>
          </tr>
        </thead>
        <tbody>
          <tr data-commodity="wheat">
            <td><strong>Trigo</strong></td>
            <td id="wheat-price">5.32 USD/bu</td>
            <td id="wheat-month" class="cambio positive">+7.00%</td>
            <td id="wheat-year" class="cambio negative">-6.01%</td>
            <td>Estable-baja</td>
            <td><a href="https://tradingeconomics.com/commodity/wheat" class="fuente-link">TradingEconomics</a></td>
          </tr>
          <tr data-commodity="corn">
            <td><strong>Maíz</strong></td>
            <td id="corn-price">4.32 USD/bu</td>
            <td id="corn-month" class="cambio positive">+0.91%</td>
            <td id="corn-year" class="cambio positive">+3.82%</td>
            <td>Alta (etanol)</td>
            <td><a href="https://www.usda.gov/oce/commodity/wasde" class="fuente-link">USDA WASDE</a></td>
          </tr>
          <tr data-commodity="rice">
            <td><strong>Arroz</strong></td>
            <td id="rice-price">10.11 USD/cwt</td>
            <td id="rice-month" class="cambio positive">+0.87%</td>
            <td id="rice-year" class="cambio negative">-30.67%</td>
            <td>Baja</td>
            <td><a href="https://tradingeconomics.com/commodity/rice" class="fuente-link">TradingEconomics</a></td>
          </tr>
          <tr data-commodity="soybeans">
            <td><strong>Soya</strong></td>
            <td id="soy-price">1,110.55¢/bu</td>
            <td id="soy-month" class="cambio positive">+10.20%</td>
            <td id="soy-year" class="cambio positive">+9.90%</td>
            <td>Alta (China)</td>
            <td><a href="https://tradingeconomics.com/commodity/soybeans" class="fuente-link">TradingEconomics</a></td>
          </tr>
          <tr data-commodity="coffee">
            <td><strong>Café Arábica</strong></td>
            <td id="coffee-price">8.902 USD/kg</td>
            <td id="coffee-month" class="cambio">—</td>
            <td id="coffee-year" class="cambio">—</td>
            <td>Estable</td>
            <td><a href="https://ycharts.com/indicators/world_coffee_arabica_price" class="fuente-link">YCharts</a></td>
          </tr>
          <tr data-commodity="cocoa">
            <td><strong>Cacao</strong></td>
            <td id="cocoa-price">6,088.40 USD/T</td>
            <td id="cocoa-month" class="cambio positive">+4.58%</td>
            <td id="cocoa-year" class="cambio negative">-23.03%</td>
            <td>Baja</td>
            <td><a href="https://tradingeconomics.com/commodity/cocoa" class="fuente-link">TradingEconomics</a></td>
          </tr>
        </tbody>
      </table>
    </div>
    <p style="text-align:center; margin-top:1rem; font-size:0.9rem; color:var(--text-light);">
      Última actualización: <span id="last-update">Cargando...</span> 
      <span id="updating-status" class="updating"></span>
    </p>
  </section>

  <!-- ANÁLISIS POR PRODUCTO -->
  <section class="container analisis-section" id="analisis">
    <h2 class="fade-up">Análisis Detallado por Producto</h2>
    <div class="analisis-grid">
      <!-- Tarjetas de análisis -->
      <div class="analisis-card scale-in">
        <h3>Trigo</h3>
        <p>Oferta global +2.49% gracias a Ucrania y EE.UU. Sequías en Australia presionan. Demanda estable en Asia.</p>
        <p><strong>Estima: $5.30–5.50/bu</strong></p>
        <a href="https://www.usda.gov/oce/commodity/wasde" class="link"><i class="fas fa-external-link-alt"></i> USDA Wheat Outlook</a>
      </div>
      <!-- Repetir otras 5 tarjetas como antes -->
    </div>
  </section>

  <!-- CONSEJOS -->
  <section class="container consejos fade-up">
    <h2>Consejos para Productores y Compradores</h2>
    <div class="consejos-grid">
      <div class="consejo-card">
        <h3><i class="fas fa-seedling"></i> Productores</h3>
        <p>Fija precios <strong>+5-10%</strong> sobre promedio para márgenes. Usa <a href="https://www.nass.usda.gov/Charts_and_Maps/Agricultural_Prices/index.php" style="color:white;text-decoration:underline;">USDA Quick Stats</a>.</p>
      </div>
      <div class="consejo-card">
        <h3><i class="fas fa-shopping-cart"></i> Compradores</h3>
        <p>Negocia <strong>-3-7%</strong> bajo promedio. Monitorea <a href="https://www.imf.org/en/Research/commodity-prices" style="color:white;text-decoration:underline;">IMF Commodities</a>.</p>
      </div>
      <div class="consejo-card">
        <h3><i class="fas fa-book"></i> Documentación</h3>
        <p>Lee informes completos. Únete al foro de AgroConnect para alertas.</p>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer fade-up">
    <div class="container" style="text-align:center;">
      <p>© 2025 <strong>AgroConnect Global</strong>. Datos en tiempo real.</p>
      <p><a href="https://www.fao.org" style="color:white;">FAO</a> | <a href="https://www.usda.gov" style="color:white;">USDA</a> | <a href="https://tradingeconomics.com" style="color:white;">TradingEconomics</a></p>
    </div>
  </footer>

  <!-- JAVASCRIPT PRECIOS AUTOMÁTICOS -->
  <script>
    const PROXY = 'https://api.allorigins.win/raw?url=';
    const UPDATE_INTERVAL = 30*60*1000;

    const APIs = {
      wheat: 'https://tradingeconomics.com/commodity/wheat',
      corn: 'https://tradingeconomics.com/commodity/corn',
      rice: 'https://tradingeconomics.com/commodity/rice',
      soybeans: 'https://tradingeconomics.com/commodity/soybeans',
      coffee: 'https://ycharts.com/indicators/world_coffee_arabica_price',
      cocoa: 'https://tradingeconomics.com/commodity/cocoa'
    };

    async function fetchPrice(commodity){
      try{
        const res = await fetch(PROXY+encodeURIComponent(APIs[commodity]));
        const text = await res.text();
        let price='—', month='—', year='—';
        if(commodity==='coffee'){
          const match=text.match(/\"value\":\s*\"?([\d.,]+)\"?/);
          price = match?`${parseFloat(match[1]).toFixed(3)} USD/kg`:'—';
        }else{
          const priceMatch=text.match(/class="datapoint[^>]*>([\d.,]+)</);
          const monthMatch=text.match(/class="datapoint[^>]*>([+-][\d.]+)%<[^>]*>1M/);
          const yearMatch=text.match(/class="datapoint[^>]*>([+-][\d.]+)%<[^>]*>1Y/);
          price = priceMatch?`${priceMatch[1]} USD/bu`:'—';
          month = monthMatch?`${monthMatch[1]}%`:'—';
          year = yearMatch?`${yearMatch[1]}%`:'—';
        }
        return {price, month, year};
      }catch(e){console.warn(`Error fetching ${commodity}:`, e); return {price:'—', month:'—', year:'—'};}
    }

    async function updatePrices(){
      document.getElementById('updating-status').textContent='Actualizando...';
      const commodities=['wheat','corn','rice','soybeans','coffee','cocoa'];
      for(const comm of commodities){
        const data=await fetchPrice(comm);
        const row=document.querySelector(`tr[data-commodity="${comm}"]`);
        if(row){
          const priceEl=row.querySelector(`#${comm}-price`);
          const monthEl=row.querySelector(`#${comm}-month`);
          const yearEl=row.querySelector(`#${comm}-year`);
          if(priceEl) priceEl.textContent=data.price;
          if(monthEl){
            monthEl.textContent=data.month;
            monthEl.className=data.month.includes('+')?'cambio positive':data.month.includes('-')?'cambio negative':'cambio';
          }
          if(yearEl){
            yearEl.textContent=data.year;
            yearEl.className=data.year.includes('+')?'cambio positive':data.year.includes('-')?'cambio negative':'cambio';
          }
        }
      }
      document.getElementById('last-update').textContent=new Date().toLocaleString('es-ES');
      document.getElementById('updating-status').textContent='Actualizado';
      setTimeout(()=>document.getElementById('updating-status').textContent='',3000);
    }

    window.addEventListener('load',()=>{
      updatePrices();
      setInterval(updatePrices,UPDATE_INTERVAL);
    });
  </script>

</body>
</html>
